<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Analytics Container</title>
    <style>
        html,
        body {
            position: absolute;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            margin: 0;
            padding: 0;
        }

        #melody-analysis {
            width: 100%;
            height: 100%;
        }
    </style>
</head>

<body>
    <iframe id="melody-analysis" scrolling="no" frameBorder="0" src="https://harmonylang.dev/melody-visualizer/"></iframe>
</body>

<script type="text/javascript">
    document.addEventListener('DOMContentLoaded', () => {
        let iframe = document.getElementById('melody-analysis').contentWindow;
        let vscode = acquireVsCodeApi();
        var messageQueue = [];
        var isLoaded = false;
        window.addEventListener('message', event => {
            if (event.data.command === "iframeReady") {
                isLoaded = true;
                for (message in messageQueue) {
                    iframe.postMessage(messageQueue[message], "*");
                }
            } else if (event.data.command === "requestGraph") {
                vscode.postMessage({command: 'requestGraph', data: null});
            } else {
                if (isLoaded) {
                    iframe.postMessage(event.data, "*");
                } else {
                    messageQueue.push(event.data);
                }
            }
        });
    });
</script>

</html>